<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>Registro de Débito/Crédito</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
</head>

<body>
    <div class="container">
        <div class="card">
            <h1 class="card-header">Registro de Lançamentos</h1>
            <div class="card-body">
                <a href="dash"><button id="btnVoltar" class="btn btn-primary" type="submit">Voltar</button> </a>
                <div class="container d-flex justify-content-center">
                    <div class="w-100" style="max-width: 400px;">

                        <form id="meuFormulario">
                            <input type="hidden" name="docempparcod" value="1">

                            <div class="form-group">

                                <label>Conta:</label>
                                <select id="tipoCobranca" name="doctccod" class="form-control" required>
                                    <option value="" hidden>Selecione</option>
                                   <option> </option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label>Valor:</label>
                                <input type="valor" name="docv" class="form-control" required
                                    placeholder="R$ 0,00">
                                <label >Observações (opcional):</label>
                                <textarea name="docobs" rows="3" class="form-control" placeholder="Informações complementares"></textarea>
                            </div>
                            
                               
                            <button class="btn btn-success" type="submit">Salvar</button>
                        </form>
                    </div>
                </div>
            </div>
            <!-- criar uma table para mostrar os lançamentos -->
            <div class="card">
                <h1 class="card-header">Lançamentos Cadastrados</h1>
                <div class="card-body">
                    <table class="table table-bordered mt-3">
                        <thead>
                            <tr>
                                <th>id</th>
                                <th>Valor</th>
                                <th>Cobrança</th>
                                <th>Tipo</th>
                                <th>Ações</th>
                            </tr>
                        </thead>
                        <tbody id="corpoTabela">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                fetch("http://localhost:3000/doc")
                    .then(res => res.json())
                    .then(dados => {
                        const corpoTabela = document.getElementById("corpoTabela");
                        corpoTabela.innerHTML = ""; // Limpa o conteúdo atual da tabela

                        dados.forEach(dado => {
                            const tr = document.createElement("tr");
                            tr.innerHTML = `
                        <td>${dado.doccod}</td>
                        <td>${dado.docv}</td>
                        <td>${dado.doctccod}</td>
                        <td>${dado.doctipo}</td>
                        <td>
                            <button class="btn btn-danger btn-sm" onclick="deletar(${dado.doccod})">Deletar</button>
                        </td>

                    `;
                            corpoTabela.appendChild(tr);
                        });
                    })
                    .catch(erro => console.error(erro));
            });

            // Deletar
            window.deletar = function (id) {
                fetch(`http://localhost:3000/doc/${id}`, {
                    method: "DELETE"
                })
                    .then(res => res.json())
                    .then(resposta => {
                        alert("Registro deletado com sucesso!");
                        // Atualiza a tabela após a exclusão
                        document.getElementById("corpoTabela").innerHTML = "";
                        location.reload();
                    })
                    .catch(erro => {
                        alert("Erro ao deletar o registro.");
                        console.error(erro);
                    });
            };


            document.addEventListener("DOMContentLoaded", function () {
                fetch('http://localhost:3000/tc')
                    .then(response => response.json())
                    .then(data => {
                        const select = document.getElementById("tipoCobranca");

                        data.forEach(item => {
                            const option = document.createElement("option");
                            option.value = item.tccod;
                            option.textContent = item.tcdes;
                            select.appendChild(option);
                        });
                    })
                    .catch(error => {
                        console.error("Erro ao carregar tipos de cobrança:", error);
                    });
            });
            // post
            document.getElementById("meuFormulario").addEventListener("submit", function (e) {
                e.preventDefault();

                const form = e.target;
                const formData = new FormData(form);

                const data = Object.fromEntries(formData.entries());

                fetch("http://localhost:3000/doc", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                })
                    .then(res => res.json())
                    .then(resposta => {
                        alert("Dados salvos com sucesso!");
                        console.log(resposta);
                    })
                    .catch(erro => {
                        alert("Erro ao salvar os dados.");
                        console.error(erro);
                    });
            });

        </script>
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
</body>

</html>